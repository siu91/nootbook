<!DOCTYPE HTML>
<html lang="zh-CN" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>构建实时湖仓 - Siu 的笔记本</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        
        <link rel="stylesheet" href="../../../../../css/variables.css">
        <link rel="stylesheet" href="../../../../../css/general.css">
        <link rel="stylesheet" href="../../../../../css/chrome.css">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="../../../../../FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="../../../../../fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../../../../highlight.css">
        <link rel="stylesheet" href="../../../../../tomorrow-night.css">
        <link rel="stylesheet" href="../../../../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        
        <link rel="stylesheet" href="../../../../../theme/style.css">
        

        

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../../../../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');
                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }
                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../../../../../SUMMARY.html"><strong aria-hidden="true">1.</strong> 思考和总结🤔</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../../../mgmt/srcwd/index.html"><strong aria-hidden="true">1.1.</strong> 团队人员模型</a></li><li class="chapter-item "><a href="../../../../../tech/backend/java-mem-mgmt/java-memory-management.html"><strong aria-hidden="true">1.2.</strong> 谈谈 Java 的内存管理（doing）</a></li></ol></li><li class="chapter-item expanded "><a href="../../../../../SUMMARY.html"><strong aria-hidden="true">2.</strong> 架构和设计</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../../../tech/backend/Java-Backend-Framework-Selection-Guide.html"><strong aria-hidden="true">2.1.</strong> Java 后端框架选型指南（doing）</a></li><li class="chapter-item "><a href="../../../../../tech/project/PGHA/pg-ha-solution.html"><strong aria-hidden="true">2.2.</strong> PG HA 方案</a></li><li class="chapter-item "><a href="../../../../../tech/project/kubesphere/基于Linux安装kubesphere3多节点集群(prod).html"><strong aria-hidden="true">2.3.</strong> KuberSphere 生产部署方案</a></li><li class="chapter-item expanded "><a href="../../../../../tech/project/lwpoc/lwpoc/架构/构建实时湖仓.html" class="active"><strong aria-hidden="true">2.4.</strong> 构建实时湖仓</a></li><li class="chapter-item "><a href="../../../../../tech/project/cicd/index.html"><strong aria-hidden="true">2.5.</strong> CICD 设计</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../../../tech/project/cicd/design/CICD架构.html"><strong aria-hidden="true">2.5.1.</strong> CI/CD 架构</a></li><li class="chapter-item "><a href="../../../../../tech/project/cicd/design/Jenkins_Cluster.html"><strong aria-hidden="true">2.5.2.</strong> Jenkins 集群</a></li><li class="chapter-item "><a href="../../../../../tech/project/cicd/design/多分支流水线设计.html"><strong aria-hidden="true">2.5.3.</strong> 多分支流水线设计</a></li><li class="chapter-item "><a href="../../../../../tech/project/cicd/design/cec-jpl设计.html"><strong aria-hidden="true">2.5.4.</strong> cec-jpl 设计</a></li><li class="chapter-item "><a href="../../../../../tech/project/cicd/design/数据库自动化.html"><strong aria-hidden="true">2.5.5.</strong> 数据库自动化</a></li><li class="chapter-item "><a href="../../../../../tech/project/cicd/design/账号体系.html"><strong aria-hidden="true">2.5.6.</strong> 账号体系</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../../../../../SUMMARY.html"><strong aria-hidden="true">3.</strong> 最佳实践</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../../../tech/bestpractices/How-to-write-an-outline-for-a-technical-solution/index.html"><strong aria-hidden="true">3.1.</strong> 怎样写一个技术方案的大纲</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../../../tech/bestpractices/How-to-write-an-outline-for-a-technical-solution/template.html"><strong aria-hidden="true">3.1.1.</strong> 《技术解决方案》模版</a></li></ol></li><li class="chapter-item "><a href="../../../../../tech/bestpractices/my-toolchain.html"><strong aria-hidden="true">3.2.</strong> 分享一下我的工具清单</a></li><li class="chapter-item "><a href="../../../../../tech/bestpractices/sql性能测试工具的设计.html"><strong aria-hidden="true">3.3.</strong> sql 性能测试工具的设计</a></li><li class="chapter-item "><a href="../../../../../tech/bestpractices/jrudf/doris-remote-udf.html"><strong aria-hidden="true">3.4.</strong> Doris Remote UDF 的开发和测试</a></li><li class="chapter-item "><a href="../../../../../tech/bestpractices/禅道工作流.html"><strong aria-hidden="true">3.5.</strong> 禅道工作流</a></li><li class="chapter-item "><a href="../../../../../tech/bestpractices/单元测试规范.html"><strong aria-hidden="true">3.6.</strong> 单元测试规范</a></li><li class="chapter-item "><a href="../../../../../tech/bestpractices/数据库自动化-Flyway使用规范.html"><strong aria-hidden="true">3.7.</strong> 数据库自动化：Flyway</a></li><li class="chapter-item "><a href="../../../../../tech/bestpractices/语义化版本控制规范.html"><strong aria-hidden="true">3.8.</strong> 语义化版本</a></li><li class="chapter-item "><a href="../../../../../tech/bestpractices/API设计规范.html"><strong aria-hidden="true">3.9.</strong> API设计规范</a></li><li class="chapter-item "><a href="../../../../../tech/bestpractices/git-collaborative-development-tutorials/git协同开发指南.html"><strong aria-hidden="true">3.10.</strong> git 协同开发指南</a></li><li class="chapter-item "><a href="../../../../../tech/bestpractices/code-review-guide-baseon-gitlab.html"><strong aria-hidden="true">3.11.</strong> Gitlab Code Review 指南</a></li><li class="chapter-item "><a href="../../../../../tech/bestpractices/gitlab-issue-workflow.html"><strong aria-hidden="true">3.12.</strong> Gitlab Issue 工作流</a></li><li class="chapter-item "><a href="../../../../../tech/bestpractices/Python编码规范.html"><strong aria-hidden="true">3.13.</strong> Python 编码规范</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Siu 的笔记本</h1>

                    <div class="right-buttons">
                        
                        
                        <a href="https://github.com/siu91/notebook" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        
                        

                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <!-- Page table of contents -->
                    <div class="sidetoc"><nav class="pagetoc"></nav></div>
                    <main>
                        <h1><a class="header" href="#构建实时湖仓" id="构建实时湖仓">构建实时湖仓</a></h1>
<blockquote>
<p>​	By <a href="">Siu</a> 2021/7/24</p>
<p>​		最近一直在思考由数据采集为起始，一直到数据治理、数据服务链路的数据湖解决方案，同时也看到了业界、社区的一些新的思路如 Hudi、 Icebreg、NewSQL，结合目前公司的的大数据架构、数据服务业务做一些更深入的分析和思考。</p>
</blockquote>
<h2><a class="header" href="#1-大数据它解决了什么问题" id="1-大数据它解决了什么问题">1 大数据，它解决了什么问题？</a></h2>
<p>​		从数据管理技术的演进历程上看，从上世纪70年代第一个关系型数据库 System R 出现，到 80、90年代，涌现了大量商业关系型数据库，Oracle、IBM DB2、微软 SQL Server，以及现在比较流行的开源数据库 MySQL、PostgreSQL。</p>
<p>​		到了 2000 年初期，互联网时代到来，数据开始指数增长，<strong>传统</strong>关系型数据库无法存储、处理如此庞大的数据。2004 年，Google 的三大论文，GFS（分布文件存储）、MR（计算）、BigTable（数据架构），依此为指导 Hadoop 生态开始繁荣发展， 大家普遍认识到单一的数据库产品已经无法满足用户的需求，数据处理领域的技术方向开始分化：</p>
<ul>
<li>
<p><strong>OLTP</strong> 领域依然被<strong>传统关系型数据库</strong>占据（SQL）</p>
</li>
<li>
<p><strong>OLAP</strong> 领域则成为了<strong>大数据</strong>技术的主战场（NOSQL）</p>
</li>
</ul>
<p>​		2010s 早期，随着硬件的发展，内存、硬盘、带宽、网络延时等有了极大提升，数据库的架构迎来变革。
以 Google Spanner 代表的<strong>分布式数据库</strong>开始大规模投入生产。这时期 OLTP 和 OLAP 的概念逐渐开始模糊，HTAP 的概念应运而生，将 OLTP 和 OLAP 混合在一起，在同一个数据库上处理这两种负载，回到了数据库产品的初衷，<strong>NewSQL</strong> 时代即将到来。</p>
<p>​		现在我们再来看下这个问题”<strong>大数据，它解决了什么问题？</strong>“</p>
<ul>
<li>传统数据库可以<strong>有限的</strong>解决 OLTP 和 OLAP 负载，但当数据庞大时，AP 问题无法解决</li>
<li>大数据<strong>致力且擅长</strong>解决数据规模庞大的 OLAP 场景，特别是 Hadoop 的数仓架构逐渐成为主流（现在看，可称为<strong>传统数仓架构</strong>）</li>
</ul>
<p>这里我们关注到两个要点：</p>
<ul>
<li>
<p>**1、数仓 **</p>
</li>
<li>
<p><strong>2、NewSQL(HTAP)</strong></p>
<p><em>下面先看下传统数仓架构的演进。</em></p>
</li>
</ul>
<h2><a class="header" href="#2-传统数仓架构的演进" id="2-传统数仓架构的演进">2 传统数仓架构的演进</a></h2>
<p>​		数据仓库的概念早在上世纪90年代就已经被提出，但随着Hadoop生态的流行，数仓开始有了实际且有力的载体。下面用几个简单的架构表达各个阶段的演进。</p>
<h3><a class="header" href="#21-离线数仓t1" id="21-离线数仓t1">2.1 离线数仓（T+1）</a></h3>
<p><em><strong><code>图 2-1，数仓架构-离线数仓</code></strong></em></p>
<p><img src="./assets/image-20210728112035505.png" alt="image-20210728112035505" /></p>
<h3><a class="header" href="#22-lambda-实时数仓tnm" id="22-lambda-实时数仓tnm">2.2 Lambda 实时数仓(T+nm)</a></h3>
<p><em><strong><code>图 2-2，数仓架构-lambda实时数仓</code></strong></em></p>
<p><img src="./assets/image-20210728112209284.png" alt="image-20210728112209284" /></p>
<h3><a class="header" href="#23-kappa-实时数仓t0" id="23-kappa-实时数仓t0">2.3 Kappa 实时数仓(T+0)</a></h3>
<p><em><strong><code>图 2-3，数仓架构-kappa实时数仓</code></strong></em></p>
<p><img src="./assets/image-20210728112258610.png" alt="image-20210728112258610" /></p>
<p><strong>数据实时性</strong>，一直都是数仓架构演进的重要目标，也是用户的重要需求。</p>
<h2><a class="header" href="#3-数仓架构的关注点" id="3-数仓架构的关注点">3 数仓架构的关注点</a></h2>
<p><em><strong><code>图 3-1，数仓架构的关注点</code></strong></em></p>
<p><img src="./assets/image-20210725123136305.png" alt="image-20210725123136305" /></p>
<h2><a class="header" href="#4-当前架构" id="4-当前架构">4 当前架构</a></h2>
<blockquote>
<p>在传统数仓构建演进的过程中，业界一直在围绕两大主要目标：</p>
<ul>
<li>数据实时性</li>
<li>海量数据处理能力</li>
</ul>
</blockquote>
<h3><a class="header" href="#41-当前架构" id="41-当前架构">4.1 当前架构</a></h3>
<p><em><strong><code>图 4-1，大数据架构</code></strong></em></p>
<p><img src="./assets/image-20210727173002135.png" alt="image-20210727173002135" /></p>
<h3><a class="header" href="#42-当前架构解决的问题" id="42-当前架构解决的问题">4.2 当前架构解决的问题</a></h3>
<p><em><strong><code>表 4-1，大数据组件解决问题</code></strong></em></p>
<table><thead><tr><th>组件</th><th>解决的问题</th><th>备注</th><th>归类</th></tr></thead><tbody>
<tr><td>HDFS</td><td>分布式文件存储</td><td></td><td>存储</td></tr>
<tr><td>MapReduce</td><td>批处理计算</td><td></td><td>计算</td></tr>
<tr><td>Hive</td><td>类SQL 的计算（MR）</td><td></td><td>计算</td></tr>
<tr><td>Hbase</td><td>BigTable 的开源实现，提供快速随机访问的数据的能力</td><td>依赖 MR 的计算能力，依托 HDFS 作为存储</td><td>存储、数据库</td></tr>
<tr><td>Kudu</td><td>HDFS&lt;-Kudu-&gt;Hbase，拥有一些OLAP和OLTP的特性，低延迟随机访问、逐行插入、更新和快速分析，中间层、集市层</td><td>依赖 Spark 、Impala 计算</td><td>存储，数据库</td></tr>
<tr><td>Spark</td><td>处理数据（kudu），Spark Streaming 实时处理</td><td></td><td>计算</td></tr>
<tr><td>Impala</td><td>交互式查询，解决hive的查询时延问题（目前用于公司的查询检索产品），MPP 计算分析</td><td>采用 HDFS 和 HBase 存储数据</td><td>计算，MPP</td></tr>
<tr><td>ES</td><td>对外服务接口</td><td></td><td>计算、存储</td></tr>
</tbody></table>
<h3><a class="header" href="#43-当前架构存在的问题" id="43-当前架构存在的问题">4.3 当前架构存在的问题</a></h3>
<ul>
<li>
<p>目前并未演进到 lambda、kappa 架构，数据延时高</p>
</li>
<li>
<p>数仓分层经过 ETL 逻辑复杂，一份数据存储于多种介质，存储、时间成本过高</p>
</li>
<li>
<p>数据链路长</p>
</li>
<li>
<p>技术栈复杂</p>
</li>
<li>
<p>数据开发技术成本大：尤其是数据开发工程师、数据分析工程师</p>
</li>
</ul>
<h2><a class="header" href="#5-我们需要解决的几大问题" id="5-我们需要解决的几大问题">5 我们需要解决的几大问题</a></h2>
<p>我们要解决的几大问题：</p>
<p>1、业务在线层：</p>
<ul>
<li>数据汇聚：在线业务的数据CDC或批量采集同步（医院的交易型系统数据）、海量存储、高并发写、行更新</li>
<li>数据服务：OLTP、海量存储（PB）</li>
</ul>
<p>2、离线数仓层（数据湖）：海量存储（10PB+）、计算（批处理）</p>
<p>3、实时数仓层：OLAP、MPP、海量存储（PB）、计算（流处理）</p>
<p>下面我们看下，上文关注的第二个重点 <strong>NewSQL(HTAP)</strong> 会给数仓建设带来什么样的解决思路。</p>
<h2><a class="header" href="#6-newsql-的实时数仓架构" id="6-newsql-的实时数仓架构">6 NewSQL 的实时数仓架构</a></h2>
<h3><a class="header" href="#61-mysql-作为数仓有什么问题" id="61-mysql-作为数仓有什么问题">6.1 MySQL 作为数仓有什么问题？</a></h3>
<blockquote>
<p>​		上面提到传统数据库具备<strong>有限的</strong>解决 OLTP 和 OLAP 的负载，但并没有深入讨论，传统关系型数据库的不足；这里假设一下用 MySQL 作为我们的数据仓库架构核心会面临哪些问题（ODS、DWD、DWS、ADS）。</p>
</blockquote>
<ul>
<li>无法满足海量数据的存储（ODS、DWD、DWS）</li>
<li>无法满足海量数据的分析需求（DWD、DWS）</li>
<li>无法满足<strong>大规模并行计算</strong>的需求（ODS、DWD）</li>
<li>无法满足<strong>横向扩展</strong>的需求（ODS、DWD、DWS）</li>
</ul>
<h3><a class="header" href="#62-tidb-能力对比" id="62-tidb-能力对比">6.2 TiDB 能力对比</a></h3>
<blockquote>
<p>​		<strong>TiDB</strong> 是一个开源的 NewSQL 数据库，支持混合交易和分析处理 （HTAP） 工作负载。它兼容 MySQL，可水平扩展、具有强一致性、分布式和高可用性的特点。</p>
</blockquote>
<p><em><strong><code>表 6-1，TiDB 能力对比</code></strong></em></p>
<table><thead><tr><th>能力</th><th>现有方案</th><th>TiDB</th></tr></thead><tbody>
<tr><td>随机访问的数据库（二级索引）</td><td>是，hbase + phoenix</td><td>是</td></tr>
<tr><td>随机访问、更新</td><td>是，kudu</td><td>是</td></tr>
<tr><td>海量存储</td><td>是，hdfs</td><td>是 + hdfs</td></tr>
<tr><td>MPP 能力</td><td>是，impala</td><td>是，Tiflash</td></tr>
<tr><td>交互查询</td><td>是，impala</td><td>是</td></tr>
<tr><td>类 sql 查询</td><td>是，impala、hive</td><td>是</td></tr>
<tr><td>批处理计算能力</td><td>是，MR、Spark</td><td>是，TiSpark</td></tr>
<tr><td>数据应用层点查能力</td><td>是，ES + hbase</td><td>是</td></tr>
<tr><td>通用的数据访问协议</td><td>否</td><td>是，兼容 MySQL 5.7</td></tr>
<tr><td>高级数据库的权限模型</td><td>否</td><td>是，mysql 的权限模型</td></tr>
<tr><td>标准SQL 查询能力</td><td>否</td><td>是，SQL</td></tr>
<tr><td>实时数仓</td><td>否，未来可演进</td><td>是</td></tr>
<tr><td>AP、TP 负载隔离</td><td>否</td><td>是，TiFlash</td></tr>
</tbody></table>
<h3><a class="header" href="#63-newsql-产品对比" id="63-newsql-产品对比">6.3 NewSQL 产品对比</a></h3>
<blockquote>
<p>待补充，StarRocks 为不同的产品类型。</p>
</blockquote>
<p><em><strong><code>表 6-2，NewSQL 产品横向对比</code></strong></em></p>
<table><thead><tr><th></th><th><a href="https://github.com/cockroachdb/cockroach">cockroachdb</a></th><th><a href="https://github.com/oceanbase/oceanbase">OceanBase</a></th><th><a href="https://github.com/pingcap/tidb">TiDB</a></th><th>StarRocks（略）</th></tr></thead><tbody>
<tr><td>类型</td><td>分布式/NewSQL/HTAP</td><td>分布式/NewSQL/HTAP</td><td>分布式/NewSQL/HTAP</td><td>分布式/MPP</td></tr>
<tr><td>定位</td><td>The most highly evolved database on the planet. Born in the Cloud. Architected to Scale and Survive.</td><td>分布式关系数据库</td><td>实时 HTAP 数据库</td><td>极速MPP数据库</td></tr>
<tr><td>开源</td><td>2014，MIT<br>Star 21.1k<br>Contributions 512</td><td>2021，MulanPubL-2.0<br>Star 3.3k<br>Contributions 70</td><td>2014，Apache License 2.0<br>Star 29.1k<br> Contributions 626</td><td>2021，Elastic License 2.0<br>Star 1.2k<br>Contributions 35</td></tr>
<tr><td>文档</td><td>[英文](CockroachDB Docs)</td><td><a href="https://www.oceanbase.com/docs/oceanbase-database/oceanbase-database/V3.1.2/features">中文</a></td><td><a href="https://docs.pingcap.com/zh/tidb/stable">中/英文</a></td><td>https://docs.starrocks.com/zh-cn/main/introduction/StarRocks_intro</td></tr>
<tr><td>数据量级</td><td>PB</td><td>PB，单表万亿，1500 节点</td><td>PB，单表千亿，500 节点</td><td>10PB</td></tr>
<tr><td>ACID</td><td>是</td><td>是</td><td>是</td><td>部分</td></tr>
<tr><td>SQL</td><td>兼容 postgresql</td><td>兼容 mysql 5.6，兼容 oracle（企业版）</td><td>兼容 mysql 5.7</td><td>兼容 mysql</td></tr>
<tr><td>安全</td><td>RBAC；LDAP</td><td>RBAC</td><td>RBAC，表级</td><td>RBAC，表级；LDAP</td></tr>
<tr><td>多租户</td><td></td><td>是，资源隔离</td><td></td><td></td></tr>
<tr><td>分布式事务</td><td>乐观事务模型</td><td></td><td>乐观事务模型</td><td></td></tr>
<tr><td>KV存储引擎</td><td>RocksDB</td><td></td><td>RocksDB</td><td></td></tr>
<tr><td>数据一致性/共识算法</td><td>Raft</td><td>Paxos</td><td>Raft</td><td>Paxos</td></tr>
<tr><td>部署</td><td></td><td></td><td>tiup</td><td>企业版有部署管理工具</td></tr>
<tr><td>监控</td><td></td><td></td><td>tidb dashboard,grafana</td><td></td></tr>
<tr><td>数据迁移</td><td></td><td></td><td></td><td></td></tr>
<tr><td>总结</td><td></td><td></td><td>AP 在 Tiflash 加持下会比 oceanbase 性能好，</td><td></td></tr>
</tbody></table>
<ul>
<li>TP：ob&gt;tidb/cr&gt;sr</li>
<li>AP：sr&gt;tidb&gt;ob/cr</li>
<li>开源和生态：tidb&gt;cr/sr/ob</li>
</ul>
<h3><a class="header" href="#64-tidb--的应用场景" id="64-tidb--的应用场景">6.4 TiDB  的应用场景</a></h3>
<blockquote>
<p>​		TiDB 的应用案例很多，有很多互联网、金融行业的成功实践案例：</p>
<p>丰巢、美团、北京银行、光大银行、中国平安、小红书，360、陆金所、中通、58、汽车之家、中国电信、国家电网</p>
</blockquote>
<ul>
<li>
<p>替换 Mysql 作为 TP库，带来 AP 能力，交易分析一体化</p>
<ul>
<li>[丰巢](<a href="https://asktug.com/t/topic/1570">[精选实践]TiDB 在丰巢核心支付平台百亿级数据的深度实践 - 技术文章 / 用户实践 - AskTUG</a>)：核心支付系统，百亿规模数据</li>
<li>[美团](<a href="https://pingcap.com/cases-cn/user-case-meituandianping">客户案例 | PingCAP</a>)：数百个 TiDB 集群，1700 多个物理节点。单集群最大 40 多个节点，单表记录最大上<strong>千亿</strong>条；</li>
<li>中国银行：支撑域、监控系统</li>
<li>[光大银行](<a href="https://pingcap.com/cases-cn/user-case-china-everbright-bank">客户案例 | PingCAP</a>)：理财业务、2000万笔/小时、5000万笔/日，40TB</li>
<li>北京银行：支付清算平台、银联无卡快捷支付平台、金融服务互联平台、网贷业务平台核心金融业务场景</li>
<li>中国平安、陆金所</li>
</ul>
</li>
<li>
<p>实时数仓方案</p>
<ul>
<li>浙商银行：实时数仓、数据量等未知</li>
<li>[小红书](<a href="https://pingcap.com/cases-cn/user-case-xiaohongshu-2">客户案例 | PingCAP</a>)：实时数据服务，数据产生的速率峰值 QPS 达到三四万，单表一天写入 5 亿左右的数据</li>
<li>[中通](<a href="https://pingcap.com/cases-cn/user-case-zto-express">客户案例 | PingCAP</a>):双十一大促中，TiDB 同时支撑线上 OLTP 和 OLAP 的业务， QPS 峰值在 12 万+，支持百亿级的插入和更新。</li>
</ul>
</li>
<li>
<p>作为组件的替代方案</p>
<ul>
<li>hbase 用 TiKV</li>
<li>MPP 场景应用</li>
</ul>
</li>
</ul>
<h3><a class="header" href="#65--构建数据湖和实时数仓" id="65--构建数据湖和实时数仓">6.5  构建数据湖和实时数仓</a></h3>
<h4><a class="header" href="#651-总体架构" id="651-总体架构">6.5.1 总体架构</a></h4>
<p><em><strong><code>图 6-1，整体架构</code></strong></em></p>
<p><img src="./assets/image-20210727173050831.png" alt="image-20210727173050831" /></p>
<p>​		用户的数据可以通过各种各样的方式写进 TiDB，在 TiDB 里面在进行一些 ETL 之类的操作然后写入到离线计算中，最后再将结果反馈到 TiDB。TiDB 可以直接对外提供实时数据分析的服务，这也是非常流行的架构之一。</p>
<h4><a class="header" href="#652-技术架构" id="652-技术架构">6.5.2 技术架构</a></h4>
<p><em><strong><code>图 6-2，技术架构</code></strong></em></p>
<p><img src="./assets/arch-%E6%8A%80%E6%9C%AF%E6%9E%B6%E6%9E%84V4.drawio.svg" alt="image-20210803104125135" /></p>
<ul>
<li>四个场景
<ul>
<li>数据汇聚
<ul>
<li>CDC</li>
<li>批流一体（Flink SQL + UDF），入湖入仓</li>
<li>异构数据海量存储</li>
<li><del>治理系统数据、标化系统维表数据</del></li>
<li><del>hive metadata（调度监控、资源监控的场景）</del></li>
</ul>
</li>
<li>数据服务
<ul>
<li>接口点查</li>
<li><del>事务型交易</del></li>
<li>数据导入/导出</li>
</ul>
</li>
<li>数据分析
<ul>
<li>数仓多维分析、关联分析（MPP/TiFlash）</li>
<li>湖仓数据关联分析（TiSpark/Spark）</li>
<li>Ad-hoc ，大数据交互查询（Trino+Iceberg，MPP/TiFlash）</li>
<li>跨源级联查询（Trino）</li>
</ul>
</li>
<li>数据共享交换
<ul>
<li>湖仓数据交换（TiSpark/Spark）</li>
<li><del>跨域的数据交换（ADS，TiBinlog）</del></li>
<li><del>跨域的数据发布/订阅（ADS，TiCDC+MQ+多租户）</del></li>
</ul>
</li>
</ul>
</li>
<li>三层架构
<ul>
<li>业务层
<ul>
<li>CDC + MQ + 批流一体（Flink SQL/UDF），实时处理入湖入仓</li>
<li>标准服务接入方式 SQL/JDBC，可负载交易系统</li>
<li>提供数据服务、数据分析、数据共享交换标准的接口/服务</li>
</ul>
</li>
<li>实时数仓
<ul>
<li>分析和点查（HTAP）</li>
<li>HTAP 负载隔离，按需扩展</li>
<li>PB 级数据负载能力</li>
<li>数据权限/访问控制（RBAC）</li>
</ul>
</li>
<li>数据湖
<ul>
<li>统一存储、异构海量存储（结构/半结构/非结构化数据）</li>
<li><del>具备湖仓一体的能力</del></li>
</ul>
</li>
</ul>
</li>
<li>主要技术栈：
<ul>
<li>存储：HDFS、TiKV/TiFlash(RocksDB)</li>
<li>计算：Flink、Spark、MR/Tez
<ul>
<li>SQL/MPP 引擎：Trino</li>
</ul>
</li>
<li>其它：
<ul>
<li>iceberg（表格式）、Ranger（权限）、ShardingSphere（脱敏加密）</li>
</ul>
</li>
</ul>
</li>
<li>降本方案
<ul>
<li><del>AIT（all-in-tidb，or in NewSQL）</del></li>
<li><del>AISR （all-in-starrocks）</del></li>
</ul>
</li>
</ul>
<h4><a class="header" href="#653-业务架构待更新" id="653-业务架构待更新">6.5.3 业务架构（待更新）</a></h4>
<p><em><strong><code>图 6-3，业务架构</code></strong></em></p>
<h4><a class="header" href="#654-收益" id="654-收益">6.5.4 收益</a></h4>
<table><thead><tr><th>序号</th><th>收益</th></tr></thead><tbody>
<tr><td>1</td><td><strong>数据实时性高</strong></td></tr>
<tr><td>2</td><td>技术栈统一，可扩展性强</td></tr>
<tr><td>3</td><td>数据业务线清晰：<br/>    - 数据开发：采集（CDC）、实时处理（Flink）、批处理（Spark）<br/>    - 数仓建设：围绕 TiDB 构建数据服务<br/>    - 数据分析： MPP 引擎、TiSpark/Spark 构建分析能力</td></tr>
<tr><td>4</td><td>数据内治理：统一的数据仓库，hive meta+治理交易数据/标化维表数据，一定程度达到”数据内治理“<br/>		- 库、表、字段元信息<br/>	    - 表：表行数、表大小、行平均大小、创建时间、更新时间</td></tr>
<tr><td>5</td><td>数据安全<br/>	- 数仓：<a href="https://docs.pingcap.com/zh/tidb/dev/security-compatibility-with-mysql">数据权限控制（RBAC，库、表）</a><br/>	- 数仓：数据脱敏、数据加密（中间件提供支持）<br/>    - <del>数据湖：iceberg +ranger</del></td></tr>
<tr><td>6</td><td>开发体验：<br/>	- 数据访问方式 SQL，Mysql 协议<br/>	- 基于 SQL 数据分析 <br/>	- 丰富的 SQL Client</td></tr>
<tr><td>7</td><td>节约成本：覆盖大部分场景，OLTP（100%）、OLAP（&gt;80%）；节约存储、计算、带宽</td></tr>
<tr><td>8</td><td>运维和管理：<br/>  -  Ambari <br/>  -  扩容工具 TiUP<br/>  -  备份与恢复工具 BR<br/>  -  监控：TiDB Dashboard 集群关键指标：SQL 分析/慢日志，实例、主机、Region 监控等</td></tr>
</tbody></table>
<h3><a class="header" href="#65-poc-计划" id="65-poc-计划">6.5 POC 计划</a></h3>
<blockquote>
<p>待补充</p>
</blockquote>
<h4><a class="header" href="#651-整体目标" id="651-整体目标">6.5.1 整体目标</a></h4>
<ul>
<li>数据实时：10 mins</li>
<li>数据仓库：分层统一存储，提供大部分数据服务能力（现有100%，未来80% 场景）</li>
<li>数据内治理：满足基础元数据治理的需求（数据仓库）</li>
<li>数据安全
<ul>
<li>数据仓库中实现基于角色的权限控制（库、表）</li>
<li>数据仓库中实现数据脱敏、加密（透明中间件）</li>
</ul>
</li>
<li>数据湖：海量存储数据（结构化、半结构化、非结构化）和数仓模型类数据、离线分析、湖仓数据交换</li>
</ul>
<p>问题：</p>
<ul>
<li>批量写的性能问题是否存在？如果存在如何规避</li>
<li>大字段的存储限制（6M-120M）</li>
<li><del>宽表限制：默认为 1017，最大可调至 4096</del></li>
<li><del>技术的掌握能力</del></li>
</ul>
<h2><a class="header" href="#ref" id="ref">REF</a></h2>
<ul>
<li>
<p>Kudu</p>
<ul>
<li>kudu现在拥有一些OLAP和OLTP的特性，但是缺少对跨行的原子性、一致性、隔离性、持久性事务的支持</li>
<li><strong>kudu仅仅是一个存储层，因此它并不处理数据，而是依赖于外部的处理引擎比如Imapala、Spark等来处理。kudu把数据按照自己的列存储格式存储在底层的Linux文件系统，不像HBase那样，Kudu不以任何方式使用HDFS。</strong></li>
</ul>
</li>
<li>
<p><a href="https://db-engines.com/en/system/Impala%3BTiDB">Impala vs. TiDB Comparison (db-engines.com)</a></p>
</li>
<li>
<p>Impala 大数据生态的MPP</p>
</li>
<li>
<p>TiDB</p>
<ul>
<li>
<p>真正意义上的 HTAP 数据库；</p>
</li>
<li>
<p>互相隔离的 OLAP 和 OLTP 负载；</p>
</li>
<li>
<p>分析友好，强实时性、强一致性的列存；</p>
</li>
</ul>
</li>
<li>
<p>DW数据分层，由下到上为DWD，DWB，DWS。</p>
<ul>
<li>
<p>DWD：data warehouse details 细节数据层，是业务层与数据仓库的隔离层。主要对ODS数据层做一些</p>
<p>数据清洗和规范化</p>
<p>的操作。</p>
<ul>
<li>数据清洗：去除空值、脏数据、超过极限范围的</li>
</ul>
</li>
<li>
<p>DWB：data warehouse base 数据基础层，存储的是客观数据，一般用作中间层，可以认为是大量指标的数据层。</p>
</li>
<li>
<p>DWS：data warehouse service 数据服务层，基于DWB上的基础数据，整合汇总成分析某一个主题域的服务数据层，一般是宽表。用于提供后续的业务查询，OLAP分析，数据分发等。</p>
<ul>
<li>用户行为，轻度聚合</li>
<li>主要对ODS/DWD层数据做一些轻度的汇总。</li>
</ul>
</li>
<li>
<p>ADS： application data store ，数据应用层</p>
</li>
</ul>
</li>
<li>
<p><a href="https://pingcap.com/blog-cn/when-tidb-and-flink-are-combined">当 TiDB 与 Flink 相结合：高效、易用的实时数仓 | PingCAP</a></p>
</li>
<li>
<p><a href="https://docs.pingcap.com/zh/tidb/stable/backup-and-restore-use-cases">BR 备份与恢复场景示例 | PingCAP Docs</a></p>
</li>
<li>
<p><a href="https://docs.pingcap.com/zh/tidb/stable/dumpling-overview">Dumpling 使用文档 | PingCAP Docs</a></p>
</li>
<li>
<p><a href="https://docs.pingcap.com/zh/tidb/stable/high-concurrency-best-practices">TiDB 高并发写入场景最佳实践 | PingCAP Docs</a></p>
</li>
<li>
<p><a href="https://docs.pingcap.com/zh/tidb/stable/benchmark-tpch">TiDB TPC-H 50G 性能测试报告 | PingCAP Docs</a></p>
</li>
<li>
<p><a href="https://pingcap.com/blog-cn/tidb-5.0-ga-is-now">迈向企业级核心场景的 TiDB 5.0 | PingCAP</a></p>
</li>
<li>
<p><a href="https://pingcap.com/blog-cn/tidb-5.0-htap-architecture-design-and-become-scenario-analysis">成为一栈式数据服务生态： TiDB 5.0 HTAP 架构设计与场景解析（混合负载） | PingCAP</a></p>
</li>
<li>
<p><a href="https://pingcap.com/solution-detail/tidb-realtime-warehouse-solution">TiDB 企业级解决方案 ：实时数仓解决方案| PingCAP</a></p>
</li>
<li>
<p><a href="https://zrj.me/archives/1969">再谈 SQL 引擎 | ZRJ</a></p>
</li>
<li>
<p><a href="https://docs.pingcap.com/zh/tidb/stable/tidb-configuration-file#txn-entry-size-limit-%E4%BB%8E-v50-%E7%89%88%E6%9C%AC%E5%BC%80%E5%A7%8B%E5%BC%95%E5%85%A5">TiDB 配置文件描述：列大小配置 6M-120M| PingCAP Docs</a></p>
</li>
<li>
<p><a href="https://pingcap.com/blog-cn/tidb-syncer">解析 TiDB 在线数据同步工具 Syncer | PingCAP</a></p>
</li>
<li>
<p><a href="https://shardingsphere.apache.org/document/legacy/4.x/document/cn/features/orchestration/encrypt/">数据脱敏 :: ShardingSphere (apache.org)</a></p>
</li>
<li>
<p><a href="https://docs.pingcap.com/zh/tidb/stable/tidb-lightning-overview">TiDB Lightning 简介：全量数据高速导入到 TiDB 集群 | PingCAP Docs</a></p>
</li>
<li>
<p><a href="https://asktug.com/t/topic/1570">【精选实践】TiDB 在丰巢核心支付平台百亿级数据的深度实践 - 技术文章 / 用户实践 - AskTUG</a></p>
</li>
<li>
<p><a href="https://pingcap.com/case/">客户案例 | PingCAP</a></p>
</li>
<li>
<p><a href="https://blog.csdn.net/john1337/article/details/118887581">基于Flink+Iceberg构建企业级实时数据湖_johnhuster的专栏-CSDN博客</a></p>
</li>
<li>
<p><a href="https://blog.csdn.net/weixin_44904816/article/details/117677783">汽车之家：基于 Flink + Iceberg 的湖仓一体架构实践_Ververica的博客-CSDN博客</a></p>
</li>
<li>
<p><a href="https://mp.weixin.qq.com/s/WCygv5L--w8I-ibbeiU-Rw">亚马逊云科技：我们的智能湖仓是架构，而非产品，更非湖仓一体 (qq.com)</a></p>
</li>
<li>
<p><a href="http://doris.apache.org/master/zh-CN/administrator-guide/materialized_view.html">物化视图 | Apache Doris</a></p>
</li>
<li>
<p><a href="https://iceberg.apache.org/evolution/">Table/Partition evolution - Apache Iceberg</a></p>
</li>
<li>
<p><a href="https://zhuanlan.zhihu.com/p/298125721">zeppelin在云音乐的实践 - 知乎 (zhihu.com)</a></p>
</li>
<li>
<p><a href="https://docs.google.com/presentation/d/1RBe8HUtGqzlyruEyCbzKh8dxOk6D7Zd5dSz1mPXvPoc/edit#slide=id.gb53c29cf3a_0_56">TiDB 2020 Hackathon - D - TiGraph - Google 幻灯片</a></p>
</li>
<li>
<p><a href="https://asktug.com/t/topic/2026">PD的时钟服务——TSO - 技术文章 / 原理解读 - AskTUG</a></p>
</li>
<li>
<p><a href="https://ipotato.me/article/67">iPotato | PD 授时服务 TSO 设计简析</a></p>
</li>
<li>
<p><a href="https://docs.pingcap.com/zh/tidb/stable/tispark-overview">TiSpark 用户指南 | PingCAP Docs</a></p>
</li>
<li>
<p><a href="https://www.infoq.cn/article/yfxkhjdask0eme2gaqnz">滴滴大数据安全权限实践-InfoQ</a></p>
</li>
<li>
<p><a href="https://docs.pingcap.com/zh/tidb/stable/bidirectional-replication-between-tidb-clusters#%E9%9B%86%E7%BE%A4%E9%97%B4%E5%8F%8C%E5%90%91%E5%90%8C%E6%AD%A5">集群间双向同步 | PingCAP Docs</a></p>
</li>
<li>
<p><a href="https://docs.pingcap.com/zh/tidb/stable/manage-ticdc#sink-uri-%E9%85%8D%E7%BD%AE-pulsar">TiCDC 运维操作及任务管理 :sink-uri 配置 pulsar| PingCAP Docs</a></p>
</li>
<li>
<p><a href="https://github.com/pingcap/ticdc/pull/751/files">support pulsar's sink. by cocotyty · Pull Request #751 · pingcap/ticdc (github.com)</a></p>
</li>
<li>
<p><a href="https://www.modb.pro/db/70554">OceanBase开源版与TiDB对比测试报告 - 墨天轮 (modb.pro)</a></p>
</li>
</ul>
<p><strong>本页编辑</strong>      <strong><a href="http://192.168.1.23/gongshiwen">@gongshiwen</a></strong> <img src="http://192.168.1.23/uploads/-/system/user/avatar/10/avatar.png?width=100" style="zoom:10%;" /> </p>

                        <div id="giscus-container"></div>
                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../../../../../tech/project/kubesphere/基于Linux安装kubesphere3多节点集群(prod).html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="../../../../../tech/project/cicd/index.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="../../../../../tech/project/kubesphere/基于Linux安装kubesphere3多节点集群(prod).html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="../../../../../tech/project/cicd/index.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="../../../../../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../../../../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../../../../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../../../../../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../../../../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../../../../book.js" type="text/javascript" charset="utf-8"></script>
        <script type="text/javascript" charset="utf-8">
        var pagePath = "tech/project/lwpoc/lwpoc/架构/构建实时湖仓.md"
        </script>


        <!-- Custom JS scripts -->
        
        <script type="text/javascript" src="../../../../../assets/custom.js"></script>
        
        <script type="text/javascript" src="../../../../../assets/showBigPicture.js"></script>
        

        

    </body>
</html>